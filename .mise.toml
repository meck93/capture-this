[settings]
experimental = true

[tools]
swift = "latest"
xcodegen = "latest"
swiftlint = "latest"
swiftformat = "latest"

[tasks.generate]
description = "Generate the Xcode project"
run = "xcodegen generate"

[tasks.lint]
description = "Run SwiftLint and SwiftFormat in lint mode"
run = ["swiftlint --strict", "swiftformat --lint ."]

[tasks.format]
description = "Format Swift code with SwiftFormat"
run = "swiftformat ."

[tasks.build]
description = "Build the app"
run = "xcodebuild -scheme CaptureThis -configuration Debug -derivedDataPath .build -destination 'platform=macOS' build"

[tasks.test]
description = "Run unit tests"
run = "xcodebuild -scheme CaptureThis -configuration Debug -derivedDataPath .build -destination 'platform=macOS' test"

[tasks.release-build]
description = "Build a release app bundle"
run = "xcodebuild -scheme CaptureThis -configuration Release -derivedDataPath .build -destination 'platform=macOS' build"

[tasks.package]
description = "Package .app.zip and .dmg"
run = "Scripts/package.sh"

[tasks.install]
description = "Build and install the app to /Applications"
run = ["mise run build", "cp -R .build/Build/Products/Debug/CaptureThis.app /Applications/", "open /Applications/CaptureThis.app"]

[tasks.reinstall]
description = "Rebuild and reinstall the app to /Applications"
run = ["mise run build", "rm -rf /Applications/CaptureThis.app", "cp -R .build/Build/Products/Debug/CaptureThis.app /Applications/", "open /Applications/CaptureThis.app"]

[tasks.build-cli]
description = "Build the CLI tool"
run = "xcodebuild -scheme CaptureThisCLI -configuration Debug -derivedDataPath .build -destination 'platform=macOS' build"

[tasks.test-core]
description = "Run CaptureThisCore unit tests"
run = "xcodebuild -scheme CaptureThisCore -configuration Debug -derivedDataPath .build -destination 'platform=macOS' test"

[tasks.ci]
description = "Generate project, lint, build all targets, run all tests"
run = ["mise run generate", "mise run lint", "mise run build", "mise run build-cli", "mise run test", "mise run test-core"]
